task buildApps {
    group = 'meta'
    dependsOn gradle.includedBuilds*.task(':web-app:build')
}

task localPublishLibraries {
    group = 'meta'
    subprojects.findAll { subProject ->
        subProject.afterEvaluate {
            subProject.tasks.findAll { task ->
                if (task.name == 'localPublish') {
                    dependsOn task
                }
            }
        }
    }
}

task gitHubPublishLibraries {
    group = 'meta'
    subprojects.findAll { subProject ->
        subProject.afterEvaluate {
            subProject.tasks.findAll { task ->
                if (task.name == 'gitHubPublish') {
                    dependsOn task
                }
            }
        }
    }
}

task localPublishServices {
    group = 'meta'
    gradle.includedBuilds.forEach { build ->
        if (build.name == 'evelyn-web-entry-point') {
            return
        }

        dependsOn build.task(':localPublish')
    }
}

task start {
    group = 'meta'
    dependsOn 'localPublishServices'
    finalizedBy ':server:evelyn-monolith:bootRun'
}

task localBuildImages {
    group = 'meta'
    gradle.includedBuilds.forEach { build ->
        dependsOn build.task(':buildImage')
    }
}

task gitHubPublishImages {
    group = 'meta'
    gradle.includedBuilds.forEach { build ->
        dependsOn build.task(':gitHubDockerPush')
    }
}
